### ctl

**long**

| **位**    | **备注**                                                   |
| --------- | ---------------------------------------------------------- |
| **64-49** | **表示线程池活动线程数量,使用AC表示**                      |
| **48-33** | **表示线程池总线程数量,使用TC表示**                        |
| **32-17** | **表示与栈顶等待线程对应的WorkQueue的scanState的变更记录** |
| **16-1**  | **表示与栈顶等待线程对应的WorkQueue在WorkQueue数组的索引** |

|                                             | **位**                                                       |
| ------------------------------------------- | ------------------------------------------------------------ |
| **AC_SHIFT = 48**                           |                                                              |
| **AC_UNIT = 0x0001L << AC_SHIFT**           | **0000000000000001 0000000000000000 0000000000000000 0000000000000000** |
| **AC_MASK = 0xffffL << AC_SHIFT**           | **1111111111111111 0000000000000000 0000000000000000 0000000000000000** |
| **TC_SHIFT = 32**                           |                                                              |
| **TC_UNIT = 0x0001L << TC_SHIFT**           | **0000000000000000 0000000000000001 0000000000000000 0000000000000000** |
| **TC_MASK    = 0xffffL << TC_SHIFT**        | **0000000000000000 1111111111111111 0000000000000000 0000000000000000** |
| **ADD_WORKER = 0x0001L << (TC_SHIFT + 15)** | **0000000000000000 1000000000000000 0000000000000000 0000000000000000** |
| **SP_MASK    = 0xffffffffL**                | **0000000000000000 0000000000000000 1111111111111111 1111111111111111** |
| **UC_MASK    = ~SP_MASK**                   | **1111111111111111 1111111111111111 0000000000000000 0000000000000000** |

---

**ForkJoinPool**

```java
private ForkJoinPool(int parallelism,
                         ForkJoinWorkerThreadFactory factory,
                         UncaughtExceptionHandler handler,
                         int mode,
                         String workerNamePrefix) {
	//我的CPU是8核,parallelism等于7
	long np = (long)(-parallelism);
	this.ctl = ((np << AC_SHIFT) & AC_MASK) | ((np << TC_SHIFT) & TC_MASK);
}
↓
↓
np
  1111111111111111 1111111111111111 1111111111111111 1111111111111001

(np << AC_SHIFT) & AC_MASK
  1111111111111001 0000000000000000 0000000000000000 0000000000000000
  1111111111111111 0000000000000000 0000000000000000 0000000000000000
↓
↓
  1111111111111001 0000000000000000 0000000000000000 0000000000000000

(np << TC_SHIFT) & TC_MASK
  1111111111111111 1111111111111001 0000000000000000 0000000000000000
  0000000000000000 1111111111111111 0000000000000000 0000000000000000
↓
↓
  0000000000000000 1111111111111001 0000000000000000 0000000000000000

((np << AC_SHIFT) & AC_MASK) | ((np << TC_SHIFT) & TC_MASK)
↓
↓
1111111111111001 1111111111111001 0000000000000000 0000000000000000
```

---

