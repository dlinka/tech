### 源码解析1.1-1.2

#### DefaultMQProducer

```java
public class DefaultMQProducer extends ClientConfig implements MQProducer {
	protected final transient DefaultMQProducerImpl defaultMQProducerImpl;
  private String producerGroup;
  //队列数量
  private volatile int defaultTopicQueueNums = 4;
}
```

#### DefaultMQProducerImpl

```java
public class DefaultMQProducerImpl implements MQProducerInner {
  //key:Topic value:TopicPublishInfo
  private final ConcurrentMap<String, TopicPublishInfo> topicPublishInfoTable = new ConcurrentHashMap<String, TopicPublishInfo>();
  private MQClientInstance mQClientFactory;
}
```

#### TopicPublishInfo

```java
public class TopicPublishInfo {
  private List<MessageQueue> messageQueueList = new ArrayList<MessageQueue>();
  private volatile ThreadLocalIndex sendWhichQueue = new ThreadLocalIndex();
  private TopicRouteData topicRouteData;
}
```

#### MQClientInstance

```java
public class MQClientInstance {
  //Group:MQProducerInner
  private final ConcurrentMap<String, MQProducerInner> producerTable = new ConcurrentHashMap<String, MQProducerInner>();
  private final MQClientAPIImpl mQClientAPIImpl;
  //Topic:TopicRouteData
  private final ConcurrentMap<String, TopicRouteData> topicRouteTable = new ConcurrentHashMap<String, TopicRouteData>();
}
```

#### MQClientAPIImpl

```java
public class MQClientAPIImpl {
	private final RemotingClient remotingClient;
}
```

#### TopicRouteData

```java
public class TopicRouteData extends RemotingSerializable {
	private List<QueueData> queueDatas;
  private List<BrokerData> brokerDatas;
}
```

#### QueueData

```java
public class QueueData implements Comparable<QueueData> {
	//"dlinkaCGdeMacBook-Pro.local"
  private String brokerName;
  //"4"
  private int readQueueNums;
  //"4"
  private int writeQueueNums;
  //"6"
  private int perm;
}
```

#### BrokerData

```java
public class BrokerData implements Comparable<BrokerData> {
	//"DefaultCluster"
  private String cluster;
	//"dlinkaCGdeMacBook-Pro.local"
  private String brokerName;
  //brokerId:"0",broker address:"10.0.161.163:10911"
  private HashMap<Long, String> brokerAddrs;
}
```

#### MessageQueue

```java
public class MessageQueue implements Comparable<MessageQueue>, Serializable {
	private String topic;
	private String brokerName;
	private int queueId;
}
```

---

### 源码解析2.1-2.2

#### BrokerController

```java
public class BrokerController {
  private MessageStore messageStore;
  private RemotingServer remotingServer;       //Netty
  private RemotingServer fastRemotingServer;   //Netty
  private ExecutorService sendMessageExecutor; //消息写入处理的线程池
}
```

#### DefaultMessageStore

```java
public class DefaultMessageStore implements MessageStore {
		private final CommitLog commitLog;
	  private final AllocateMappedFileService allocateMappedFileService; //创建CommitLog文件的线程
}
```

#### CommitLog

```java
public class CommitLog {
  protected final MappedFileQueue mappedFileQueue;
  protected final PutMessageLock putMessageLock; //并发写入消息用到的锁
  private final AppendMessageCallback appendMessageCallback; //写入消息类
}
```

#### MappedFileQueue

```java
public class MappedFileQueue {
  private final CopyOnWriteArrayList<MappedFile> mappedFiles = new CopyOnWriteArrayList<>(); //MappedFile就是CommitLog文件
}
```

#### MappedFile

```java
public class MappedFile extends ReferenceResource {
	private static final AtomicLong TOTAL_MAPPED_VIRTUAL_MEMORY = new AtomicLong(0); //创建一个CommitLog文件就增加1个G
  private static final AtomicInteger TOTAL_MAPPED_FILES = new AtomicInteger(0); //CommitLog文件个数
  
  private String fileName; //文件名包含路径
  private MappedByteBuffer mappedByteBuffer; //MMAP
}
```