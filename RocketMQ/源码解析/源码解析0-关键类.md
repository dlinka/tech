#### BrokerController

```java
public class BrokerController {
  private MessageStore messageStore;
  private RemotingServer remotingServer;       //Netty
  private RemotingServer fastRemotingServer;   //Netty
  private ExecutorService sendMessageExecutor; //消息写入处理的线程池
}
```

#### DefaultMessageStore

```java
public class DefaultMessageStore implements MessageStore {
		private final CommitLog commitLog;
	  private final AllocateMappedFileService allocateMappedFileService; //创建CommitLog文件的线程
}
```

#### CommitLog

```java
public class CommitLog {
  protected final MappedFileQueue mappedFileQueue;
  protected final PutMessageLock putMessageLock; //并发写入消息用到的锁
  private final AppendMessageCallback appendMessageCallback; //写入消息类
}
```

#### MappedFileQueue

```java
public class MappedFileQueue {
  private final CopyOnWriteArrayList<MappedFile> mappedFiles = new CopyOnWriteArrayList<>(); //MappedFile就是CommitLog文件
}
```

#### MappedFile

```java
public class MappedFile extends ReferenceResource {
	private static final AtomicLong TOTAL_MAPPED_VIRTUAL_MEMORY = new AtomicLong(0); //创建一个CommitLog文件就增加1个G
  private static final AtomicInteger TOTAL_MAPPED_FILES = new AtomicInteger(0); //CommitLog文件个数
  
  private String fileName; //文件名包含路径
  private MappedByteBuffer mappedByteBuffer; //MMAP
}
```