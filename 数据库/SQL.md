### 阿里的一道面试题

假设我有一个网站,每次登陆的时候都会记录该用户的登陆信息,该信息用关系型数据库来存储,字段设计如下:

```
client_id, user_name, login_timestamp
```

统计最近10天登陆最频繁的10个用户,排序并打印出这10个用户各登陆多少次

```sql
SELECT user_name, COUNT(user_name) AS login_time
FROM table
WHERE login_timestamp BETWEEN DATE_SUB(NOW(), INTERVAL 10 DAY) AND NOW()
GROUP BY user_name
ORDER BY login_time DESC
LIMIT 10
```

---

### 查询表中每一个用户最后评论的id

#### 同一个uid,id大create_time也大

| id   | uid  | content | created_time        | updated_time        |
| ---- | ---- | ------- | ------------------- | ------------------- |
| 1    | 1    | 评论1   | 2019-05-17 00:00:00 | 2019-05-17 00:00:00 |
| 2    | 1    | 评论2   | 2019-05-17 00:10:01 | 2019-05-17 00:10:01 |
| 3    | 2    | 评论1   | 2019-05-17 00:10:02 | 2019-05-17 00:10:02 |
| 4    | 2    | 评论2   | 2019-05-17 00:00:03 | 2019-05-17 00:00:03 |
| 5    | 3    | 评论1   | 2019-05-17 00:10:04 | 2019-05-17 00:10:04 |
| 6    | 1    | 评论3   | 2019-05-17 00:00:05 | 2019-05-17 00:00:05 |
| 7    | 4    | 评论1   | 2019-05-17 00:00:06 | 2019-05-17 00:00:06 |
| 8    | 4    | 评论2   | 2019-05-17 00:10:07 | 2019-05-17 00:10:07 |
| 9    | 4    | 评论3   | 2019-05-17 00:00:08 | 2019-05-17 00:00:08 |
| 10   | 4    | 评论4   | 2019-05-17 00:00:09 | 2019-05-17 00:00:09 |
| 11   | 3    | 评论2   | 2019-05-17 00:00:10 | 2019-05-17 00:00:10 |

```sql
-- 这种查询只会查询出来第一个
SELECT * FROM content GROUP BY uid
```

| id   | uid  | content | created_time        | updated_time        |
| ---- | ---- | ------- | ------------------- | ------------------- |
| 1    | 1    | 评论1   | 2019-05-17 00:00:00 | 2019-05-17 00:00:00 |
| 3    | 2    | 评论1   | 2019-05-17 00:00:02 | 2019-05-17 00:00:02 |
| 5    | 3    | 评论1   | 2019-05-17 00:00:04 | 2019-05-17 00:00:04 |
| 7    | 4    | 评论1   | 2019-05-17 00:00:06 | 2019-05-17 00:00:06 |

```sql
SELECT * FROM content
WHERE id IN (SELECT MAX(id) FROM content GROUP BY uid)
ORDER BY uid
```

| id   | uid  | content | created_time        | updated_time        |
| ---- | ---- | ------- | ------------------- | ------------------- |
| 6    | 1    | 评论3   | 2019-05-17 00:00:05 | 2019-05-17 00:00:05 |
| 4    | 2    | 评论2   | 2019-05-17 00:00:03 | 2019-05-17 00:00:03 |
| 11   | 3    | 评论2   | 2019-05-17 00:00:10 | 2019-05-17 00:00:10 |
| 10   | 4    | 评论4   | 2019-05-17 00:00:09 | 2019-05-17 00:00:09 |

#### 同一个uid,id大created_time不一定大

| id   | uid  | content | created_time        | updated_time        |
| ---- | ---- | ------- | ------------------- | ------------------- |
| 1    | 1    | 评论1   | 2019-05-17 00:00:00 | 2019-05-17 00:00:00 |
| 2    | 1    | 评论2   | 2019-05-17 00:10:01 | 2019-05-17 00:10:01 |
| 3    | 2    | 评论1   | 2019-05-17 00:10:02 | 2019-05-17 00:10:02 |
| 4    | 2    | 评论2   | 2019-05-17 00:00:03 | 2019-05-17 00:00:03 |
| 5    | 3    | 评论1   | 2019-05-17 00:10:04 | 2019-05-17 00:10:04 |
| 6    | 1    | 评论3   | 2019-05-17 00:00:05 | 2019-05-17 00:00:05 |
| 7    | 4    | 评论1   | 2019-05-17 00:00:06 | 2019-05-17 00:00:06 |
| 8    | 4    | 评论2   | 2019-05-17 00:10:07 | 2019-05-17 00:10:07 |
| 9    | 4    | 评论3   | 2019-05-17 00:00:08 | 2019-05-17 00:00:08 |
| 10   | 4    | 评论4   | 2019-05-17 00:00:09 | 2019-05-17 00:00:09 |
| 11   | 3    | 评论2   | 2019-05-17 00:00:10 | 2019-05-17 00:00:10 |

```sql
SELECT a.* FROM content AS a
RIGHT JOIN 
(SELECT uid, MAX(created_time) AS created_time FROM content WHERE uid IS NOT NULL GROUP BY uid) AS b
ON a.uid=b.uid AND a.created_time=b.created_time
ORDER BY a.uid ASC
```

| id   | uid  | content | created_time        | updated_time        |
| ---- | ---- | ------- | ------------------- | ------------------- |
| 2    | 1    | 评论2   | 2019-05-17 00:10:01 | 2019-05-17 00:10:01 |
| 3    | 2    | 评论1   | 2019-05-17 00:10:02 | 2019-05-17 00:10:02 |
| 5    | 3    | 评论1   | 2019-05-17 00:10:04 | 2019-05-17 00:10:04 |
| 8    | 4    | 评论2   | 2019-05-17 00:10:07 | 2019-05-17 00:10:07 |
